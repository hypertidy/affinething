<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Raster Georeferencing, Grid Affine Transforms, Cell Abstraction • affinity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Raster Georeferencing, Grid Affine Transforms, Cell Abstraction">
<meta property="og:description" content="Tools for raster georeferencing, grid affine transforms, and general raster logic. 
 These functions provide converters between raster specifications, world vector, geotransform, 
 RasterIO window, and RasterIO window in sf package list format. There are functions to offset
 a matrix by padding any of four corners (useful for vectorizing neighbourhood operations), and
 helper functions to harvesting user clicks on a graphics device to use for simple georeferencing
 of images.  Methods used are available from &lt;https://en.wikipedia.org/wiki/World_file&gt; and
 &lt;https://gdal.org/user/raster_data_model.html&gt;. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">affinity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/adjacencies.html">adjacencies</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hypertidy/affinity/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="affinity" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#affinity" class="anchor"></a>affinity</h1></div>
<p>The goal of affinity is to provide the basic tools used for raster grid georeferencing. This includes:</p>
<ul>
<li>the affine transform</li>
<li>the world file model</li>
<li>the GDAL RasterIO window model</li>
<li>basic tools for performing grid calculations</li>
<li>simple control point georeferencing for un-mapped rasters.</li>
</ul>
<p>The main use at the moment is the ability to get a geotransform from an extent and dimension, this makes it easy to drive GDAL functions and to compare with the RasterIO logic in the sf package raster reader.</p>
<p>The main functions for georeferencing are <code><a href="reference/affinething.html">affinething()</a></code> to collect drawn points interactively from an un-mapped raster image and <code><a href="reference/domath.html">domath()</a></code> to calculate the extent of the raster in geographic terms and <code><a href="reference/assignproj.html">assignproj()</a></code> to apply a map projection inline. There are some other experimental functions to write GDAL VRT <code>gdalvrt()</code> and to store some known cases for unmapped image sources.</p>
<p>The basic tools still rely on the raster package.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the dev version of affinity from <a href="https://github.com/hypertidy/affinity/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"hypertidy/affinity"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>This examples takes an an un-mapped raster and <a href="https://en.wikipedia.org/wiki/Georeferencing">georefences</a> it by defining some control points for a simple (offset and scale) <a href="https://en.wikipedia.org/wiki/Affine_transformation">affine transformation</a>.</p>
<p>Generally, we want <strong>diagonal points</strong>, so I tend to think “southwest” and “northeast”, it doesn’t really matter where they are as long as there’s some pixels between them in both directions. Monterey Bay is very recognizable so I read off some long-lat control points using <a href="https://r-spatial.github.io/mapview/">mapview</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/affinity">affinity</a></span><span class="op">)</span>
<span class="co">#data("montereybay", package = "rayshader")</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"monterey"</span>, package <span class="op">=</span> <span class="st">"affinity"</span><span class="op">)</span>


<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="co">## we know that rayshader works transpose</span>
<span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">monterey</span><span class="op">)</span><span class="op">)</span>

<span class="va">prj</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84"</span>
<span class="co">## the north tip of Pacific Grove</span>
<span class="va">sw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">121.93348</span>, <span class="fl">36.63674</span><span class="op">)</span>
<span class="co">## the inlet at Moss Landing</span>
<span class="va">ne</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">121.78825</span>, <span class="fl">36.80592</span><span class="op">)</span>
<span class="co">#mapview::mapview(c(sw[1], ne[1]), c(sw[2], ne[2]), crs = prj)</span></code></pre></div>
<p>We can obtain raw (graphics) coordinates of those locations from our image, by plotting it and clicking twice with <code><a href="reference/affinething.html">affinething()</a></code>.</p>
<p>Note the order, the first point is “sw” and the second is “ne” - the order is not important but it must match.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## mask the raster so we can see easily where we need to click</span>
<span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/affinething.html">affinething</a></span><span class="op">(</span><span class="va">r</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>In this example the points are</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># xy &lt;- structure(c(0.65805655219227, 0.858931100128933, 0.367586425626388,</span>
<span class="co"># 0.589597209007295), .Dim = c(2L, 2L), .Dimnames = list(NULL,</span>
<span class="co">#     c("x", "y")))</span>
<span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.440321955368224</span>, <span class="fl">0.580740883913579</span>, <span class="fl">0.453408220576972</span>,
<span class="fl">0.625733980086801</span><span class="op">)</span>, .Dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">2L</span><span class="op">)</span>, .Dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Please note that if the matrix changes, then the values above will have to change as well (this has happened).</p>
<p><img src="reference/figures/README-affine-thing2-1.png" width="100%"></p>
<p>Now we have everything we need to re-map our raster! We don’t need to project our points as the known locations are in the same coordinate system as the source data. (In other situations we might georeference using a graticule on a projected map.)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mapped</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/assignproj.html">assignproj</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/setExtent.html">setExtent</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="reference/domath.html">domath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">sw</span>, <span class="va">ne</span><span class="op">)</span>, <span class="va">xy</span>, <span class="va">r</span>, proj <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>, <span class="va">prj</span><span class="op">)</span>

<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu">ne_countries</span><span class="op">(</span>country <span class="op">=</span> <span class="st">"United States of America"</span>, scale <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">mapped</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu">viridis</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">m</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/contour.html">contour</a></span><span class="op">(</span><span class="va">mapped</span>, levels <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>, lty <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-affine-remap-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#mv &lt;- mapview::mapview(mapped)</span></code></pre></div>
<hr>
<p>Please note that the ‘affinity’ project is released with a <a href="https://github.com/hypertidy/affinity/blob/master/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=affinity">https://​cloud.r-project.org/​package=affinity</a>
</li>
<li>Browse source code at <br><a href="https://github.com/hypertidy/affinity/">https://​github.com/​hypertidy/​affinity/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/hypertidy/affinity/issues">https://​github.com/​hypertidy/​affinity/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Michael D. Sumner <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/hypertidy/affinity"><img src="https://travis-ci.org/hypertidy/affinity.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://ci.appveyor.com/project/hypertidy/affinity"><img src="https://ci.appveyor.com/api/projects/status/github/hypertidy/affinity?branch=master&amp;svg=true" alt="AppVeyor build status"></a></li>
<li><a href="https://codecov.io/gh/hypertidy/affinity?branch=master"><img src="https://codecov.io/gh/hypertidy/affinity/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://CRAN.R-project.org/package=affinity"><img src="https://www.r-pkg.org/badges/version/affinity" alt="CRAN status"></a></li>
<li><a href="https://github.com/hypertidy/affinity/actions"><img src="https://github.com/hypertidy/affinity/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
